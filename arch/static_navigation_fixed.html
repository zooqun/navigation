<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é™æ€å¯¼èˆªé¡µé¢</title>
    <style>
        /* å…¨å±€æ ·å¼ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f5f7fa;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* é¡¶éƒ¨å¯¼èˆªæ  */
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 0;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 2.5em;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        /* ä¸»å†…å®¹åŒºåŸŸ */
        .container {
            flex: 1;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            width: 100%;
        }

        /* åˆ†ç±»æ ‡ç­¾ */
        .category-tabs {
            display: flex;
            overflow-x: auto;
            white-space: nowrap;
            padding: 10px 0;
            margin-bottom: 20px;
            gap: 10px;
            scrollbar-width: thin;
            scrollbar-color: #ccc transparent;
        }

        .category-tabs::-webkit-scrollbar {
            height: 6px;
        }

        .category-tabs::-webkit-scrollbar-thumb {
            background: #ccc;
            border-radius: 3px;
        }

        .category-tab {
            padding: 10px 20px;
            background: white;
            color: #667eea;
            border-radius: 25px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            white-space: nowrap;
        }

        .category-tab:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .category-tab.active {
            background: #667eea;
            color: white;
            border-color: #764ba2;
        }

        /* åˆ†ç±»å†…å®¹ */
        .category-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
        }

        .subcategory {
            margin-bottom: 30px;
        }

        .subcategory-title {
            font-size: 1.5em;
            font-weight: 700;
            color: #444;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
        }

        /* é“¾æ¥ç½‘æ ¼ */
        .links-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }

        /* é“¾æ¥å¡ç‰‡ */
        .link-card {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 16px;
            transition: all 0.3s ease;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .link-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            border-color: #667eea;
        }

        .link-card-header {
            display: flex;
            align-items: flex-start;
            margin-bottom: 12px;
            gap: 12px;
        }

        .link-icon {
            width: 40px;
            height: 40px;
            border-radius: 12px;
            background: #f1f5f9;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            flex-shrink: 0;
        }

        .link-icon img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 8px;
        }

        .link-title {
            flex: 1;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 4px;
            font-size: 1em;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
            line-height: 1.4;
            min-height: 2.8em;
            max-height: 2.8em;
        }

        .link-url {
            font-size: 0.85em;
            color: #64748b;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            flex-shrink: 0;
        }

        /* ç‰ˆæœ¬ä¿¡æ¯ */
        .version-info {
            text-align: center;
            padding: 20px;
            color: #64748b;
            font-size: 0.9em;
            background: white;
            border-top: 1px solid #e2e8f0;
        }

        .version-info a {
            color: #667eea;
            text-decoration: none;
            font-weight: 500;
        }

        .version-info a:hover {
            text-decoration: underline;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2em;
            }

            .container {
                padding: 10px;
            }

            .category-content {
                padding: 20px;
            }

            .links-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <h1>ğŸ”— é™æ€å¯¼èˆªé¡µé¢</h1>
        <p>å¿«é€Ÿè®¿é—®æ‚¨æ”¶è—çš„ç½‘ç«™å’Œèµ„æº</p>
    </header>

    <div class="container">
        <div class="category-tabs"></div>
        <div class="category-content"></div>
    </div>

    <div class="version-info">
        é™æ€å¯¼èˆªé¡µé¢ v1.0 | <a href="#" onclick="alert('çº¯é™æ€ç‰ˆæœ¬ï¼Œæ— éœ€åå°æœåŠ¡å™¨\nå¯ç›´æ¥ä½œä¸ºæ–°æ ‡ç­¾é¡µä½¿ç”¨ï¼'); return false;">ä½¿ç”¨è¯´æ˜</a>
    </div>

    <script>
        // å¯¼èˆªæ•°æ® - ä»pintree.jsonæ–‡ä»¶åŠ è½½
        let navigationData = {};
        
        // åŠ è½½JSONæ–‡ä»¶å¹¶è½¬æ¢æ ¼å¼çš„å‡½æ•°
        async function loadNavigationData() {
            try {
                // ä»pintree.jsonæ–‡ä»¶è¯»å–æ•°æ®
                const response = await fetch('pintree.json');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const jsonData = await response.json();
                
                // è½¬æ¢æ•°æ®æ ¼å¼
                // pintree.jsonæ ¼å¼: [{type: 'folder', title: 'èµ„æº', children: [...]}]
                // è½¬æ¢ä¸º: {"èµ„æº": {"å®˜æ–¹å¸ƒå‘Š": [{type: 'link', title: '...', url: '...', icon: '...'}]}}
                
                // éå†é¡¶å±‚æ–‡ä»¶å¤¹
                jsonData.forEach(topFolder => {
                    if (topFolder.type === 'folder' && topFolder.title !== 'Other bookmarks') {
                        const categoryData = {};
                        
                        // éå†äºŒçº§æ–‡ä»¶å¤¹
                        if (topFolder.children && Array.isArray(topFolder.children)) {
                            topFolder.children.forEach(subFolder => {
                                if (subFolder.type === 'folder') {
                                    const linksArray = [];
                                    
                                    // éå†é“¾æ¥
                                    if (subFolder.children && Array.isArray(subFolder.children)) {
                                        subFolder.children.forEach(item => {
                                            if (item.type === 'link') {
                                                linksArray.push({
                                                    type: 'link',
                                                    title: item.title || 'æœªçŸ¥æ ‡é¢˜',
                                                    url: item.url || '#',
                                                    icon: item.icon || 'ğŸ”—' // ä½¿ç”¨æ–‡ä»¶ä¸­çš„iconæˆ–é»˜è®¤å›¾æ ‡
                                                });
                                            }
                                        });
                                    }
                                    
                                    // æ·»åŠ å­åˆ†ç±»åŠé“¾æ¥
                                    categoryData[subFolder.title] = linksArray;
                                }
                            });
                        }
                        
                        // æ·»åŠ ä¸»åˆ†ç±»
                        navigationData[topFolder.title] = categoryData;
                    }
                });
                
                console.log('å¯¼èˆªæ•°æ®åŠ è½½æˆåŠŸ:', navigationData);
                return true;
            } catch (error) {
                console.error('åŠ è½½å¯¼èˆªæ•°æ®å¤±è´¥:', error);
                // å¦‚æœåŠ è½½å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤æ•°æ®ç»“æ„é¿å…é¡µé¢å´©æºƒ
                navigationData = {"é»˜è®¤åˆ†ç±»": {"é»˜è®¤å­åˆ†ç±»": []}};
                return false;
            }
        }
        
        // åˆå§‹åŒ–å‡½æ•°
        async function initApp() {
            // å…ˆåŠ è½½å¯¼èˆªæ•°æ®
            await loadNavigationData();
            
            // ç„¶åæ‰§è¡Œåˆå§‹åŒ–é€»è¾‘
            const categories = Object.keys(navigationData);
            const categoryTabsContainer = document.querySelector('.category-tabs');
            const categoryContentContainer = document.querySelector('.category-content');
            
            // åˆ›å»ºåˆ†ç±»æ ‡ç­¾
            categories.forEach(category => {
                const tab = document.createElement('a');
                tab.href = '#';
                tab.className = 'category-tab';
                tab.textContent = category;
                
                tab.addEventListener('click', (e) => {
                    e.preventDefault();
                    document.querySelectorAll('.category-tab').forEach(t => {
                        t.classList.remove('active');
                    });
                    tab.classList.add('active');
                    renderContent(category);
                });
                
                categoryTabsContainer.appendChild(tab);
            });
            
            // æ¿€æ´»ç¬¬ä¸€ä¸ªåˆ†ç±»
            if (categories.length > 0) {
                categoryTabsContainer.querySelector('.category-tab').classList.add('active');
                renderContent(categories[0]);
            }
        }
        
        // æ¸²æŸ“å†…å®¹
        function renderContent(category) {
            const categoryContentContainer = document.querySelector('.category-content');
            categoryContentContainer.innerHTML = '';
            
            const subcategories = Object.keys(navigationData[category]);
            
            subcategories.forEach(subcategory => {
                const links = navigationData[category][subcategory];
                
                const subcategoryElement = document.createElement('div');
                subcategoryElement.className = 'subcategory';
                
                const subcategoryTitle = document.createElement('h3');
                subcategoryTitle.className = 'subcategory-title';
                subcategoryTitle.textContent = subcategory;
                subcategoryElement.appendChild(subcategoryTitle);
                
                const linksGrid = document.createElement('div');
                linksGrid.className = 'links-grid';
                
                links.forEach(link => {
                    const linkCardHtml = createLinkCard(link);
                    const tempDiv = document.createElement('div');
                    tempDiv.innerHTML = linkCardHtml;
                    const linkCard = tempDiv.firstElementChild;
                    
                    // æ·»åŠ ç‚¹å‡»äº‹ä»¶
                    linkCard.addEventListener('click', () => {
                        window.open(link.url, '_blank');
                    });
                    
                    linksGrid.appendChild(linkCard);
                });
                
                subcategoryElement.appendChild(linksGrid);
                categoryContentContainer.appendChild(subcategoryElement);
            });
        }
        
        // åˆ›å»ºé“¾æ¥å¡ç‰‡HTML
        function createLinkCard(link) {
            const { title, url } = link;
            
            // ä»URLæå–åŸŸåç”¨äºæ˜¾ç¤º
            function getDomainFromUrl(url) {
                try {
                    // ç¡®ä¿URLæœ‰åè®®å‰ç¼€
                    let processedUrl = url;
                    if (!processedUrl.startsWith('http://') && !processedUrl.startsWith('https://')) {
                        processedUrl = 'https://' + processedUrl;
                    }
                    
                    const urlObj = new URL(processedUrl);
                    return urlObj.hostname;
                } catch (e) {
                    // å¦‚æœæ— æ³•è§£æURLï¼Œè¿”å›åŸå§‹URLçš„å‰30ä¸ªå­—ç¬¦
                    return url.length > 30 ? url.substring(0, 30) + '...' : url;
                }
            }
            
            const domain = getDomainFromUrl(url);
            
            // ç”Ÿæˆfavicon URL
            let faviconUrl = null;
            try {
                let processedUrl = url;
                if (!processedUrl.startsWith('http://') && !processedUrl.startsWith('https://')) {
                    processedUrl = 'https://' + processedUrl;
                }
                const urlObj = new URL(processedUrl);
                faviconUrl = `https://www.google.com/s2/favicons?domain=${urlObj.hostname}&sz=64`;
            } catch (e) {
                // å¦‚æœæ— æ³•ç”Ÿæˆfavicon URLï¼Œä½¿ç”¨é»˜è®¤å›¾æ ‡
                console.warn('æ— æ³•ç”Ÿæˆfavicon URL:', e);
            }
            
            // åˆ›å»ºå›¾æ ‡å…ƒç´  - ä¼˜å…ˆä½¿ç”¨favicon
            let iconElement = '';
            if (faviconUrl) {
                // ä½¿ç”¨imgæ ‡ç­¾æ˜¾ç¤ºç½‘ç«™favicon
                iconElement = `<img src="${faviconUrl}" alt="${domain}" onerror="this.onerror=null; this.src='';">`;
            } else {
                // å¦‚æœæ— æ³•è·å–faviconï¼Œä½¿ç”¨é»˜è®¤å›¾æ ‡
                iconElement = 'ğŸ”—';
            }
            
            return `
                <div class="link-card" data-url="${url}">
                    <div class="link-card-header">
                        <div class="link-icon">${iconElement}</div>
                        <div class="link-title">${title}</div>
                    </div>
                    <div class="link-url">${url}</div>
                </div>
            `;
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', initApp);
        
        // æ·»åŠ é”®ç›˜å¿«æ·é”®
        document.addEventListener('keydown', async (e) => {
            // Ctrl+R åˆ·æ–°é¡µé¢
            if (e.ctrlKey && e.key === 'r') {
                e.preventDefault(); // é˜»æ­¢é»˜è®¤çš„åˆ·æ–°è¡Œä¸º
                await initApp(); // è°ƒç”¨å¼‚æ­¥åˆå§‹åŒ–å‡½æ•°
            }
        });
    </script>
</body>
</html>